-- SELDA RP AUTO LOOTBOX OPENER v1.0
-- Auto-TP to ProximityPrompt + Trigger (Press E)
-- ON/OFF Toggle | Mobile/PC | No Crash

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local PlayerGui = Player:WaitForChild("PlayerGui")

-- === CONFIG ===
local SEARCH_KEYWORDS = {"lootbox", "chest", "loot", "treasure", "box", "crate"}  -- Add more if needed
local TP_DISTANCE = 0  -- Distance to stand before triggering
local TRIGGER_DELAY = 0.1  -- Delay between triggers
local MAX_RANGE = 1000  -- Max search distance

-- === VARIABLES ===
local autoRunning = false
local connection = nil
local foundPrompts = {}

-- === FIND ALL PROXIMITY PROMPTS ===
local function findLootPrompts()
    foundPrompts = {}
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("ProximityPrompt") then
            local parent = obj.Parent
            local name = (parent and parent.Name:lower()) or ""
            local modelName = (parent and parent.Parent and parent.Parent.Name:lower()) or ""
            
            -- Match keywords
            for _, keyword in pairs(SEARCH_KEYWORDS) do
                if string.find(name, keyword) or string.find(modelName, keyword) then
                    table.insert(foundPrompts, obj)
                    break
                end
            end
        end
    end
end

-- === AUTO LOOP ===
local function startAutoLoot()
    if autoRunning then return end
    autoRunning = true
    
    connection = RunService.Heartbeat:Connect(function()
        if not autoRunning or not Character or not HumanoidRootPart then return end
        
        findLootPrompts()  -- Refresh list
        
        for _, prompt in pairs(foundPrompts) do
            if not autoRunning then break end
            
            local root = prompt.Parent
            if not root then continue end
            
            local hrp = root:FindFirstChild("HumanoidRootPart") or root
            local distance = (HumanoidRootPart.Position - hrp.Position).Magnitude
            
            -- Teleport if far
            if distance > TP_DISTANCE then
                HumanoidRootPart.CFrame = hrp.CFrame * CFrame.new(0, 0, -TP_DISTANCE)
                task.wait(0.2)
            end
            
            -- Trigger Prompt
            if distance <= TP_DISTANCE + 10 then
                pcall(function()
                    prompt:InputHoldBegin()
                    task.wait(0.1)
                    prompt:InputHoldEnd()
                end)
                task.wait(TRIGGER_DELAY)
            end
        end
    end)
end

local function stopAutoLoot()
    autoRunning = false
    if connection then
        connection:Disconnect()
        connection = nil
    end
end

-- === UI (Simple Toggle) ===
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoLootbox"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 250, 0, 120)
Frame.Position = UDim2.new(0, 10, 0.5, -60)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 12)
Corner.Parent = Frame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 35)
Title.BackgroundColor3 = Color3.fromRGB(0, 140, 255)
Title.Text = "AUTO LOOTBOX"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = Frame

local Corner2 = Instance.new("UICorner")
Corner2.CornerRadius = UDim.new(0, 12)
Corner2.Parent = Title

local Toggle = Instance.new("TextButton")
Toggle.Size = UDim2.new(0.8, 0, 0, 40)
Toggle.Position = UDim2.new(0.1, 0, 0.4, 0)
Toggle.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
Toggle.Text = "OFF"
Toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
Toggle.Font = Enum.Font.GothamBold
Toggle.TextSize = 18
Toggle.Parent = Frame

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 10)
ToggleCorner.Parent = Toggle

Toggle.MouseButton1Click:Connect(function()
    if autoRunning then
        stopAutoLoot()
        Toggle.Text = "OFF"
        Toggle.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        StarterGui:SetCore("SendNotification", {Title="Auto Loot", Text="Stopped", Duration=2})
    else
        startAutoLoot()
        Toggle.Text = "ON"
        Toggle.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        StarterGui:SetCore("SendNotification", {Title="Auto Loot", Text="Started! Finding lootboxes...", Duration=3})
    end
end)

-- === AUTO START ON RESPAWN ===
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

-- === NOTIFICATION ===
StarterGui:SetCore("SendNotification", {
    Title = "SELDA RP Auto Lootbox";
    Text = "Loaded! Toggle ON to start.";
    Duration = 5;
})
